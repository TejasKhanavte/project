<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Examination & Certificate System</title>
   
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .feature-card {
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .certificate-photo {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            border: 5px solid #10b981;
            border-radius: 15px;
            background-image: url('https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=800&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #1a202c;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            text-shadow: 0 1px 3px rgba(255, 255, 255, 0.8);
        }

        h2,
        h3,
        h4,
        p {
            margin: 0 0 12px 0;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
        }

        .result-table th,
        .result-table td {
            border: 1px solid #d1d5db;
            padding: 8px;
            text-align: left;
        }

        .result-table th {
            background-color: #f3f4f6;
        }

        .hidden {
            display: none;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            border: 1px solid #d1d5db;
            padding: 8px;
            text-align: left;
        }

        .admin-table th {
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="hero-bg text-white">
        <div class="container mx-auto px-4 py-16">
            <nav class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold">EduQuiz System</h1>
                <div id="navActions">
                    <button id="registerBtn"
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mr-4">Register</button>
                    <button id="loginBtn" class="bg-white text-purple-600 px-4 py-2 rounded">Login</button>
                </div>
                <div id="userNav" class="hidden">
                    <span id="welcomeUser"></span>
                    <button id="logoutBtn"
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded ml-4">Logout</button>
                </div>
                <div id="adminNav" class="hidden">
                    <button id="adminPanelBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Admin
                        Panel</button>
                </div>
            </nav>
            <div class="text-center">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4b174397-f726-4471-9b77-3fc8c4d50f87.png"
                    alt="Bright modern classroom with students taking online exams on laptops and tablets in a clean, well-lit study environment"
                    class="mx-auto w-full max-w-lg mb-6 rounded-lg shadow-lg" />
                <h2 class="text-4xl font-extrabold mb-4">Revolutionize Education with Online Exams & Certificates</h2>
                <p class="text-lg mb-8 max-w-2xl mx-auto">Empower colleges, schools, and coaching centers with seamless
                    MCQ tests, instant results, and digital certificates for students.</p>
                <button id="viewQuizzesBtn"
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-semibold transition duration-300">View
                    Quizzes</button>
                <button id="createQuizBtn"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-semibold transition duration-300 ml-4 hidden"
                    onclick="showSection('quizCreation')">Create Quiz</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-16">
        <!-- Features Section -->
        <section id="features" class="mb-16">
            <h3 class="text-3xl font-bold text-center mb-8">Key Features</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="feature-card bg-white p-6 rounded-lg shadow-md">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/5f57b7ff-58b4-4003-998f-6ed697e36403.png"
                        alt="User registration form with secure login fields for students and teachers"
                        class="w-full h-32 object-cover mb-4 rounded" />
                    <h4 class="text-xl font-semibold mb-2">User Registration & Login</h4>
                    <p>Secure accounts for students, teachers, and admins.</p>
                    <button onclick="showSection('userRegistration')"
                        class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Get Started</button>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow-md">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/24369ab8-6f40-4f40-a320-04931bb24e13.png"
                        alt="Teacher creating multiple choice questions on a digital interface"
                        class="w-full h-32 object-cover mb-4 rounded" />
                    <h4 class="text-xl font-semibold mb-2">Quiz & MCQ Creation</h4>
                    <p>Instructors can build custom tests with multiple questions.</p>
                    <button onclick="showSection('quizCreation')"
                        class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Create Quiz</button>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow-md">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4fc5734b-d083-425a-a0b9-11422b10cc10.png"
                        alt="Student taking an online exam on a computer screen with timer"
                        class="w-full h-32 object-cover mb-4 rounded" />
                    <h4 class="text-xl font-semibold mb-2">Online Test Taking</h4>
                    <p>Students take exams remotely with timer and random questions.</p>
                </div>
                <div class="feature-card bg-white p-6 rounded-lg shadow-md">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/97f982b0-5d1e-4253-af4a-63616b1e7b9c.png"
                        alt="Graph showing exam results with percentages and pass fail status"
                        class="w-full h-32 object-cover mb-4 rounded" />
                    <h4 class="text-xl font-semibold mb-2">Instant Results</h4>
                    <p>Automatic grading, percentages, pass/fail, downloadable reports.</p>
                </div>
            </div>
        </section>

        <!-- User Registration Section -->
        <section id="userRegistration" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">User Registration & Login</h3>
            <form id="registerForm" class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Name</label>
                    <input type="text" id="regName" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="regEmail" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="regPassword" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Role</label>
                    <select id="regRole" class="w-full px-4 py-2 border rounded" required>
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button type="submit"
                    class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded font-semibold">Register</button>
                <button type="button" id="switchToLogin"
                    class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded font-semibold">Already have
                    an account? Login</button>
            </form>
            <form id="loginForm" class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md hidden">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-2 border rounded" required>
                </div>
                <button type="submit"
                    class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded font-semibold">Login</button>
            </form>
        </section>

        <!-- Quiz Creation Section -->
        <section id="quizCreation" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">Create Quiz</h3>
            <form id="quizForm" class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Quiz Title</label>
                    <input type="text" id="quizTitle" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Subject</label>
                    <input type="text" id="quizSubject" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Time Limit (minutes)</label>
                    <input type="number" id="quizTime" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div id="questionsContainer">
                    <h4 class="text-lg font-semibold mb-4">Add Questions</h4>
                    <div class="question-item mb-6">
                        <label class="block text-sm font-medium mb-2">Question 1</label>
                        <input type="text" placeholder="Enter question"
                            class="w-full px-4 py-2 border rounded mb-2 question-text" required>
                        <input type="text" placeholder="Option A" class="w-full px-4 py-2 border rounded mb-2 option-a"
                            required>
                        <input type="text" placeholder="Option B" class="w-full px-4 py-2 border rounded mb-2 option-b"
                            required>
                        <input type="text" placeholder="Option C" class="w-full px-4 py-2 border rounded mb-2 option-c"
                            required>
                        <input type="text" placeholder="Option D" class="w-full px-4 py-2 border rounded mb-2 option-d"
                            required>
                        <select class="w-full px-4 py-2 border rounded correct">
                            <option value="a">A</option>
                            <option value="b">B</option>
                            <option value="c">C</option>
                            <option value="d">D</option>
                        </select>
                    </div>
                </div>
                <button type="button" id="addQuestionBtn"
                    class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded mr-4">Add Question</button>
                <button type="submit"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded font-semibold">Create
                    Quiz</button>
            </form>
        </section>

        <!-- Quiz List Section -->
        <section id="quizList" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">Available Quizzes</h3>
            <div id="quizzesContainer" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <!-- Take Quiz Section -->
        <section id="takeQuiz" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8" id="quizTitleHeader"></h3>
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
                <div id="timer" class="text-right mb-4 text-red-500 font-semibold">Time Left: <span
                        id="timeLeft"></span></div>
                <form id="quizTakingForm">
                    <!-- Questions will be dynamically added -->
                </form>
                <button id="submitQuizBtn"
                    class="mt-6 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded font-semibold">Submit
                    Quiz</button>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">Results</h3>
            <div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md">
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Quiz</th>
                            <th>Score</th>
                            <th>Percentage</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="resultTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Certificate Section -->
        <section id="certificate" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">Certificate of Completion</h3>
            <div class="max-w-lg mx-auto certificate">
                <div id="certificateContent">
                    <h4 class="text-2xl font-bold mb-4">Certificate</h4>
                    <p id="certificateText"></p>
                    <p id="certificateDate"></p>
                </div>
                <button onclick="downloadCertificate()"
                    class="mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded font-semibold">Download/Print</button>
            </div>
        </section>

        <!-- Admin Panel Section -->
        <section id="adminPanel" class="mb-16 hidden">
            <h3 class="text-3xl font-bold text-center mb-8">Admin Panel</h3>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold mb-4">Users</h4>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold mb-4">Quiz Bank</h4>
                    <ul id="quizBankList" class="list-disc list-inside"></ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold mb-4">Results & Certificates</h4>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Quiz</th>
                                <th>Score</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="adminResultsTable"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p>© 2025 EduQuiz System. All rights reserved. Designed for educational institutions.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentUser = null;
        let currentQuiz = null;
        let quizTimer = null;
        let timeLeft = 0;
        let questionsArray = [];

        // Initialize on load
        window.onload = init;

        function init() {
            loadData();
            checkLoginStatus();
            displayQuizzes();
            displayResults();
        }

        // Data management (simulating localStorage as backend)
        function loadData() {
            // In a real backend, this would be API calls
            if (!localStorage.getItem('eduquiz_users')) localStorage.setItem('eduquiz_users', JSON.stringify([]));
            if (!localStorage.getItem('eduquiz_quizzes')) localStorage.setItem('eduquiz_quizzes', JSON.stringify([]));
            if (!localStorage.getItem('eduquiz_results')) localStorage.setItem('eduquiz_results', JSON.stringify([]));
        }

        function getUsers() { return JSON.parse(localStorage.getItem('eduquiz_users')); }
        function saveUsers(users) { localStorage.setItem('eduquiz_users', JSON.stringify(users)); }

        function getQuizzes() { return JSON.parse(localStorage.getItem('eduquiz_quizzes')); }
        function saveQuizzes(quizzes) { localStorage.setItem('eduquiz_quizzes', JSON.stringify(quizzes)); }

        function getResults() { return JSON.parse(localStorage.getItem('eduquiz_results')); }
        function saveResults(results) { localStorage.setItem('eduquiz_results', JSON.stringify(results)); }

        function checkLoginStatus() {
            const user = JSON.parse(localStorage.getItem('eduquiz_currentUser') || 'null');
            if (user) loginSuccess(user);
        }

        // Event listeners
        document.getElementById('registerBtn').onclick = () => showSection('userRegistration');
        document.getElementById('loginBtn').onclick = () => showSection('userRegistration');
        document.getElementById('logoutBtn').onclick = logout;
        document.getElementById('adminPanelBtn').onclick = () => showSection('adminPanel');
        document.getElementById('viewQuizzesBtn').onclick = () => showSection('quizList');
        document.getElementById('switchToLogin').onclick = () => {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        };
        document.getElementById('addQuestionBtn').onclick = addQuestion;

        // Forms
        document.getElementById('registerForm').onsubmit = registerUser;
        document.getElementById('loginForm').onsubmit = loginUser;
        document.getElementById('quizForm').onsubmit = createQuiz;
        document.getElementById('submitQuizBtn').onclick = submitQuiz;

        function showSection(sectionId) {
            const sections = document.querySelectorAll('main section');
            sections.forEach(s => s.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // Registration
        function registerUser(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;

            const users = getUsers();
            if (users.find(u => u.email === email)) {
                alert('User already exists!');
                return;
            }
            const newUser = { id: Date.now(), name, email, password, role };
            users.push(newUser);
            saveUsers(users);
            alert('Registration successful! Please login.');
            document.getElementById('registerForm').reset();
        }

        // Login
        function loginUser(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const users = getUsers();
            const user = users.find(u => u.email === email && u.password === password);
            if (!user) {
                alert('Invalid credentials!');
                return;
            }
            loginSuccess(user);
        }

        function loginSuccess(user) {
            currentUser = user;
            localStorage.setItem('eduquiz_currentUser', JSON.stringify(user));
            document.getElementById('navActions').classList.add('hidden');
            document.getElementById('welcomeUser').textContent = `Welcome, ${user.name}!`;
            document.getElementById('userNav').classList.remove('hidden');
            if (user.role === 'admin') document.getElementById('adminNav').classList.remove('hidden');
            if (user.role === 'teacher') document.getElementById('createQuizBtn').classList.remove('hidden');
            hideAllSections();
            showSection('quizList');
        }

        function logout() {
            localStorage.removeItem('eduquiz_currentUser');
            currentUser = null;
            document.getElementById('navActions').classList.remove('hidden');
            document.getElementById('userNav').classList.add('hidden');
            document.getElementById('adminNav').classList.add('hidden');
            document.getElementById('createQuizBtn').classList.add('hidden');
            hideAllSections();
            showSection('features');
        }

        // Quiz Creation
        function addQuestion() {
            const container = document.getElementById('questionsContainer');
            const questionCount = container.querySelectorAll('.question-item').length + 1;
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item mb-6';
            questionItem.innerHTML = `
                <label class="block text-sm font-medium mb-2">Question ${questionCount}</label>
                <input type="text" placeholder="Enter question" class="w-full px-4 py-2 border rounded mb-2 question-text" required>
                <input type="text" placeholder="Option A" class="w-full px-4 py-2 border rounded mb-2 option-a" required>
                <input type="text" placeholder="Option B" class="w-full px-4 py-2 border rounded mb-2 option-b" required>
                <input type="text" placeholder="Option C" class="w-full px-4 py-2 border rounded mb-2 option-c" required>
                <input type="text" placeholder="Option D" class="w-full px-4 py-2 border rounded mb-2 option-d" required>
                <select class="w-full px-4 py-2 border rounded correct"><option value="a">A</option><option value="b">B</option><option value="c">C</option><option value="d">D</option></select>
            `;
            container.appendChild(questionItem);
        }

        function createQuiz(e) {
            e.preventDefault();
            if (!currentUser || currentUser.role !== 'teacher') {
                alert('Only teachers can create quizzes!');
                return;
            }
            const title = document.getElementById('quizTitle').value;
            const subject = document.getElementById('quizSubject').value;
            const timeLimit = parseInt(document.getElementById('quizTime').value);

            questionsArray = [];
            document.querySelectorAll('.question-item').forEach(item => {
                questionsArray.push({
                    question: item.querySelector('.question-text').value,
                    options: {
                        a: item.querySelector('.option-a').value,
                        b: item.querySelector('.option-b').value,
                        c: item.querySelector('.option-c').value,
                        d: item.querySelector('.option-d').value,
                    },
                    correct: item.querySelector('.correct').value
                });
            });

            const quiz = { id: Date.now(), title, subject, timeLimit, questions: questionsArray, creator: currentUser.email };
            const quizzes = getQuizzes();
            quizzes.push(quiz);
            saveQuizzes(quizzes);
            alert('Quiz created successfully!');
            displayQuizzes();
            hideAllSections();
            showSection('quizList');
        }

        // Display Quizzes
        function displayQuizzes() {
            const quizzes = getQuizzes();
            const container = document.getElementById('quizzesContainer');
            container.innerHTML = '';
            quizzes.forEach(quiz => {
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow-md';
                card.innerHTML = `
                    <h4 class="text-xl font-semibold mb-2">${quiz.title}</h4>
                    <p class="mb-2">Subject: ${quiz.subject}</p>
                    <p class="mb-4">Questions: ${quiz.questions.length}</p>
                    <button class="take-quiz-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded" data-quiz-id="${quiz.id}">Take Quiz</button>
                `;
                container.appendChild(card);
            });

            document.querySelectorAll('.take-quiz-btn').forEach(btn => {
                btn.onclick = function () { startQuiz(parseInt(this.dataset.quizId)); };
            });
        }

        // Take Quiz
        function startQuiz(quizId) {
            currentQuiz = getQuizzes().find(q => q.id === quizId);
            if (!currentQuiz) return;

            questionsArray = [...currentQuiz.questions];
            shuffleArray(questionsArray); // Random order

            document.getElementById('quizTitleHeader').textContent = currentQuiz.title;
            timeLeft = currentQuiz.timeLimit * 60;
            updateTimer();
            quizTimer = setInterval(updateTimer, 1000);

            const form = document.getElementById('quizTakingForm');
            form.innerHTML = '';
            questionsArray.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'mb-6';
                questionDiv.innerHTML = `
                    <h5 class="text-lg mb-4">${index + 1}. ${q.question}</h5>
                    <label class="block mb-2"><input type="radio" name="q${index}" value="a" class="mr-2" required>A) ${q.options.a}</label>
                    <label class="block mb-2"><input type="radio" name="q${index}" value="b" class="mr-2" required>B) ${q.options.b}</label>
                    <label class="block mb-2"><input type="radio" name="q${index}" value="c" class="mr-2" required>C) ${q.options.c}</label>
                    <label class="block mb-2"><input type="radio" name="q${index}" value="d" class="mr-2" required>D) ${q.options.d}</label>
                `;
                form.appendChild(questionDiv);
            });

            showSection('takeQuiz');
        }

        function updateTimer() {
            if (timeLeft <= 0) {
                clearInterval(quizTimer);
                submitQuiz();
                return;
            }
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timeLeft').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function submitQuiz() {
            if (quizTimer) clearInterval(quizTimer);
            const answers = [];
            for (let i = 0; i < questionsArray.length; i++) {
                const question = questionsArray[i];
                const answer = new FormData(document.getElementById('quizTakingForm')).get(`q${i}`);
                answers.push({ questionIndex: i, givenAnswer: answer });
            }

            let correct = 0;
            answers.forEach((ans, idx) => {
                if (ans.givenAnswer === questionsArray[idx].correct) correct++;
            });

            const score = correct;
            const total = questionsArray.length;
            const percentage = Math.round((correct / total) * 100);
            const status = percentage >= 50 ? 'Passed' : 'Failed';

            const result = { quizId: currentQuiz.id, userEmail: currentUser.email, score, total, percentage, status, date: new Date().toISOString() };
            const results = getResults();
            results.push(result);
            saveResults(results);

            // Save answers for security/audit
            const audit = { quizId: currentQuiz.id, userId: currentUser.id, answers, timeStamp: new Date().toISOString() };
            const audits = JSON.parse(localStorage.getItem('eduquiz_audits') || '[]');
            audits.push(audit);
            localStorage.setItem('eduquiz_audits', JSON.stringify(audits));

            displayResults();
            generateCertificate(currentQuiz, percentage, status);
            showSection('results');
            showSection('certificate');
        }

        // Shuffle Array for Random Questions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Display Results
        function displayResults() {
            const results = getResults().filter(r => r.userEmail === currentUser?.email);
            const tbody = document.getElementById('resultTableBody');
            tbody.innerHTML = '';
            results.forEach(result => {
                const quizzes = getQuizzes();
                const quiz = quizzes.find(q => q.id === result.quizId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${quiz ? quiz.title : 'Unknown'}</td>
                    <td>${result.score}/${result.total}</td>
                    <td>${result.percentage}%</td>
                    <td>${result.status}</td>
                    <td><button class="download-result bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" data-result-id="${result.id}">Download</button></td>
                `;
                tbody.appendChild(tr);
            });

            // Admin Panel Updates
            if (currentUser && currentUser.role === 'admin') {
                const usersTable = document.getElementById('usersTable');
                usersTable.innerHTML = '';
                getUsers().forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${user.name}</td><td>${user.email}</td><td>${user.role}</td>`;
                    usersTable.appendChild(tr);
                });

                const quizBankList = document.getElementById('quizBankList');
                quizBankList.innerHTML = '';
                getQuizzes().forEach(quiz => {
                    const li = document.createElement('li');
                    li.textContent = `${quiz.title} (${quiz.questions.length} questions)`;
                    quizBankList.appendChild(li);
                });

                const adminResultsTable = document.getElementById('adminResultsTable');
                adminResultsTable.innerHTML = '';
                results.forEach(result => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${result.userEmail}</td><td>${quiz ? quiz.title : 'Unknown'}</td><td>${result.score}/${result.total}</td><td>${result.status}</td>`;
                    adminResultsTable.appendChild(tr);
                });
            }
        }

        // Generate Certificate
        function generateCertificate(quiz, percentage, status) {
            const certificateText = `This certifies that ${currentUser.name} has completed the Online Exam in ${quiz.subject} with ${percentage}% score and status: ${status}.`;
            const certificateDate = `Date: ${new Date().toLocaleDateString()}`;

            document.getElementById('certificateText').textContent = certificateText;
            document.getElementById('certificateDate').textContent = certificateDate;
        }
 // Download Certificate (simple text download)
       function downloadCertificate() {
            const content = document.getElementById('certificateContent').innerText;
            const blob = new Blob([content], { type: 'txt/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Certificate.txt';
            link.click();

}

        function hideAllSections() {
            const sections = document.querySelectorAll('section');
            sections.forEach(s => s.classList.add('hidden'));
        }
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('download-result')) {
                const tr = e.target.closest('tr');
                const cells = tr.querySelectorAll('td');
                const resultText = `
Quiz: ${cells[0].innerText}
Score: ${cells[1].innerText}
Percentage: ${cells[2].innerText}
Status: ${cells[3].innerText}
        `;
                const blob = new Blob([resultText], { type: 'text/plain' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'Result.txt';
                link.click();
            }
        });
    </script>
</script>
</body>

</html>
</content>
</create_file>